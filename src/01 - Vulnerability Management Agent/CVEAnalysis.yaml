Descriptor:
  Name: CVEAnalysis
  DisplayName: CVE Analysis
  Description:  >-
    This plugin contains skills to perform a comprehensive analysis of Common Vulnerabilities and
    Exposures (CVE) data to identify potential security risks and vulnerabilities within an organization's IT infrastructure.
SkillGroups:
  - Format: KQL
    Skills:
      - Name: IdentifyExploitableVulnerabilitiesAndImpactedDevices
        DisplayName: Identify Exploitable Vulnerabilities and Impacted Devices
        Description: >-
          This skill analyzes devices in the environment to identify software vulnerabilities 
          with a CVSS score above a defined threshold (CVSS == 3) and an available exploit. 
          It provides a list of affected devices, associated CVEs, severity levels, publication dates, and impacted software, 
          cross-referencing with the software inventory for a complete risk overview.
        Settings:
          Target: Defender
          Template: |-
            let CvssMinimum = 3;
            let VulnerabiltiesList = ( DeviceTvmSoftwareVulnerabilitiesKB
            | where CvssScore > CvssMinimum
            and IsExploitAvailable == true
            | join DeviceTvmSoftwareVulnerabilities on CveId
            | where isnotempty(DeviceId)
            | summarize AffectedSoftware=make_set(SoftwareName) by DeviceName, CVE=CveId, Severity=VulnerabilitySeverityLevel, PublishedDate
            );
            let SoftwareInEnvironment = ( DeviceTvmSoftwareInventory
            | distinct SoftwareName, DeviceName
            | summarize SoftwareInventory=make_set(SoftwareName) by DeviceName
            );
            VulnerabiltiesList
            | join SoftwareInEnvironment on DeviceName
            | extend SoftwareOnDevice = set_intersect(todynamic(tostring(AffectedSoftware)), SoftwareInventory)
            | project-away SoftwareInventory, AffectedSoftware
            | summarize AffectedDevices=make_set(DeviceName) by CVE, PublishedDate, Severity, tostring(SoftwareOnDevice)
      
    